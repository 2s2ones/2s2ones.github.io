<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snake Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:black;
  color:white;
  font-family:Segoe UI,Arial;
  overflow:hidden;
}

canvas{display:block}

/* Rain */
#rain{
  position:fixed;
  inset:0;
  z-index:-10;
}

/* Glass UI */
.glass{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.2);
  box-shadow:0 0 25px rgba(255,0,0,.25);
  border-radius:14px;
  padding:12px;
}

#ui{
  position:fixed;
  top:10px;
  left:10px;
  right:10px;
  display:flex;
  justify-content:space-between;
  gap:10px;
}

button{
  background:#150000;
  color:#fff;
  border:1px solid #ff0033;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
}

#gameWrap{
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#hud{
  position:fixed;
  bottom:10px;
  left:10px;
}

#mobileControls{
  position:fixed;
  bottom:20px;
  right:20px;
  display:grid;
  grid-template-columns:60px 60px 60px;
  grid-template-rows:60px 60px 60px;
  gap:5px;
}

.ctrl{
  background:rgba(255,0,0,0.25);
  border:1px solid red;
  border-radius:10px;
  font-size:18px;
}

#chat{
  position:fixed;
  right:10px;
  top:80px;
  width:220px;
  height:260px;
  display:none;
}

</style>
</head>
<body>

<canvas id="rain"></canvas>

<div id="ui">
  <div class="glass">
    Mode:
    <select id="modeSel">
      <option>Classic</option>
      <option>No-walls</option>
      <option>Speed</option>
      <option>Practice</option>
    </select>
    <button onclick="togglePause()">Pause</button>
    <button onclick="toggleFull()">Fullscreen</button>
  </div>

  <div class="glass">
    Server: <span id="serverStatus">Offline (Local)</span>
  </div>
</div>

<div id="gameWrap">
  <canvas id="game" width="600" height="600"></canvas>
</div>

<div id="hud" class="glass">
Score: <span id="score">0</span><br>
Time: <span id="time">0</span>s
</div>

<div id="mobileControls">
  <div></div><button class="ctrl" onclick="setDir(0,-1)">⬆</button><div></div>
  <button class="ctrl" onclick="setDir(-1,0)">⬅</button>
  <button class="ctrl" onclick="setDir(0,0)">⏺</button>
  <button class="ctrl" onclick="setDir(1,0)">➡</button>
  <div></div><button class="ctrl" onclick="setDir(0,1)">⬇</button><div></div>
</div>

<script>
/* ---------- Rain ---------- */
const rain=document.getElementById("rain"),rctx=rain.getContext("2d");
function resizeRain(){rain.width=innerWidth;rain.height=innerHeight}
resizeRain();addEventListener("resize",resizeRain);
const drops=Array.from({length:400},()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,v:4+Math.random()*5,l:10+Math.random()*20}));
function rainLoop(){
  rctx.clearRect(0,0,rain.width,rain.height);
  rctx.strokeStyle="rgba(255,0,0,0.4)";
  drops.forEach(d=>{
    rctx.beginPath();
    rctx.moveTo(d.x,d.y);
    rctx.lineTo(d.x,d.y+d.l);
    rctx.stroke();
    d.y+=d.v;
    if(d.y>innerHeight){d.y=-20;d.x=Math.random()*innerWidth}
  });
  requestAnimationFrame(rainLoop);
}
rainLoop();

/* ---------- Game ---------- */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
const grid=20;
let snake=[{x:10,y:10}],snake2=[{x:20,y:20}];
let dir={x:1,y:0},dir2={x:-1,y:0};
let food={x:15,y:15};
let score=0,time=0;
let paused=false;
let multiplayerLocal=true;

function setDir(x,y){if(x||y)dir={x,y}}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp")dir={x:0,y:-1};
  if(e.key==="ArrowDown")dir={x:0,y:1};
  if(e.key==="ArrowLeft")dir={x:-1,y:0};
  if(e.key==="ArrowRight")dir={x:1,y:0};

  if(e.key==="w")dir2={x:0,y:-1};
  if(e.key==="s")dir2={x:0,y:1};
  if(e.key==="a")dir2={x:-1,y:0};
  if(e.key==="d")dir2={x:1,y:0};
});

function togglePause(){paused=!paused}
function toggleFull(){
  if(!document.fullscreenElement)document.body.requestFullscreen();
  else document.exitFullscreen();
}

function drawCell(x,y,color){
  ctx.shadowBlur=10;
  ctx.shadowColor=color;
  ctx.fillStyle=color;
  ctx.fillRect(x*grid,y*grid,grid-1,grid-1);
}

function update(){
  if(paused) return;

  const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
  snake.unshift(head);
  if(head.x===food.x && head.y===food.y){
    score++;
    food={x:Math.random()*29|0,y:Math.random()*29|0};
  }else snake.pop();

  if(multiplayerLocal){
    const h2={x:snake2[0].x+dir2.x,y:snake2[0].y+dir2.y};
    snake2.unshift(h2);snake2.pop();
  }

  // walls
  if(head.x<0||head.y<0||head.x>=30||head.y>=30) reset();
}

function reset(){
  snake=[{x:10,y:10}];
  snake2=[{x:20,y:20}];
  score=0;
}

function draw(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,600,600);

  // walls
  ctx.strokeStyle="red";
  ctx.strokeRect(0,0,600,600);

  snake.forEach(p=>drawCell(p.x,p.y,"#ff0033"));
  if(multiplayerLocal) snake2.forEach(p=>drawCell(p.x,p.y,"#00c6ff"));

  drawCell(food.x,food.y,"#00ff00");
}

setInterval(()=>{if(!paused){update();draw();}},120);
setInterval(()=>{if(!paused){time++;document.getElementById("time").innerText=time}},1000);
setInterval(()=>document.getElementById("score").innerText=score,100);

/* ---------- Multiplayer placeholder ---------- */
function connectServer(){
  // will use your WebSocket later
  document.getElementById("serverStatus").innerText="Offline (Local)";
}
connectServer();
</script>

</body>
</html>
