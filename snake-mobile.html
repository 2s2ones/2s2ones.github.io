<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snake Mobile ‚Äì 2s2ones</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
html,body{
margin:0;
height:100%;
background:#000;
font-family:Arial;
color:white;
overflow:hidden;
touch-action:none;
}

canvas{position:fixed;top:0;left:0}
#game{z-index:2}

.glass{
background:rgba(255,255,255,0.08);
backdrop-filter:blur(16px);
border:1px solid rgba(255,255,255,0.25);
border-radius:16px;
box-shadow:0 0 25px rgba(255,0,0,0.45);
padding:10px 14px;
}

#topbar{
position:fixed;
top:10px;
left:50%;
transform:translateX(-50%);
display:flex;
gap:6px;
z-index:5;
}

#controls{
position:fixed;
bottom:130px;
left:50%;
transform:translateX(-50%);
display:grid;
grid-template-columns:70px 70px 70px;
grid-template-rows:70px 70px;
gap:8px;
z-index:6;
}

.ctrl{
background:rgba(255,0,0,0.25);
border:1px solid #ff3b3b;
border-radius:14px;
font-size:26px;
color:white;
display:flex;
align-items:center;
justify-content:center;
}

#info{
position:fixed;
bottom:10px;
left:50%;
transform:translateX(-50%);
width:90%;
text-align:center;
z-index:6;
}

select,button{
background:rgba(255,0,0,0.25);
border:1px solid #ff3b3b;
color:white;
padding:6px 10px;
border-radius:8px;
}

.badge{
background:rgba(255,255,255,0.1);
border:1px solid rgba(255,255,255,0.3);
padding:4px 8px;
border-radius:8px;
}
</style>
</head>
<body>

<canvas id="rain"></canvas>
<canvas id="game" width="600" height="600"></canvas>

<div id="topbar" class="glass">
<b>üêç</b>
<select id="mode">
<option value="classic">Classic</option>
<option value="speed">Speed</option>
<option value="walls">Walls</option>
<option value="local">Local 2P</option>
<option value="online">Online</option>
</select>
<button onclick="startGame()">Start</button>
<button onclick="goFullscreen()">‚õ∂</button>
<span class="badge" id="status">Idle</span>
</div>

<!-- Player 1 arrows -->
<div id="controls">
<div></div>
<div class="ctrl" onclick="setDir1(0,-1)">‚ñ≤</div>
<div></div>

<div class="ctrl" onclick="setDir1(-1,0)">‚óÄ</div>
<div class="ctrl" onclick="setDir1(0,1)">‚ñº</div>
<div class="ctrl" onclick="setDir1(1,0)">‚ñ∂</div>
</div>

<!-- Player 2 WASD buttons -->
<div id="controls2" style="position:fixed;bottom:130px;right:10px;display:grid;grid-template-columns:60px 60px;grid-template-rows:60px 60px;gap:6px;z-index:6;">
<div class="ctrl" onclick="setDir2(0,-1)">W</div>
<div></div>
<div class="ctrl" onclick="setDir2(-1,0)">A</div>
<div class="ctrl" onclick="setDir2(1,0)">D</div>
<div></div>
<div class="ctrl" onclick="setDir2(0,1)">S</div>
</div>

<div id="info" class="glass">
Player 1 ‚Üí arrows<br>
Player 2 ‚Üí WASD buttons (local)<br>
Online uses WebSocket ‚Äì if offline, auto local
</div>

<script>
/* ================= Rain ================= */
const rain=document.getElementById("rain");
const rctx=rain.getContext("2d");

function resize(){
rain.width=innerWidth;
rain.height=innerHeight;
}
resize(); onresize=resize;

let drops=[...Array(300)].map(()=>({x:Math.random()*rain.width,y:Math.random()*rain.height,s:6}));

function drawRain(){
rctx.clearRect(0,0,rain.width,rain.height);
rctx.strokeStyle="rgba(255,0,0,0.6)";
drops.forEach(d=>{
rctx.beginPath();
rctx.moveTo(d.x,d.y);
rctx.lineTo(d.x,d.y+12);
rctx.stroke();
d.y+=d.s;
if(d.y>rain.height){d.y=-10;d.x=Math.random()*rain.width;}
});
requestAnimationFrame(drawRain);
}
drawRain();

/* ================= Game ================= */

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

const size=20;
const cells=canvas.width/size;
const SPEED=120;

let snakes,food,dx1,dy1,dx2,dy2,mode,run=false,socket=null;

function resetGame(){
snakes=[[{x:5,y:5}],[{x:20,y:20}]];
dx1=1;dy1=0;
dx2=-1;dy2=0;
spawnFood();
}

function spawnFood(){
food={x:Math.floor(Math.random()*cells),y:Math.floor(Math.random()*cells)};
}

function startGame(){
mode=document.getElementById("mode").value;
resetGame();
run=true;

if(mode==="online") connectWS();
else socket=null;

document.getElementById("status").innerText="Running";
loop();
}

function drawBorder(){
ctx.strokeStyle="#ff3333";
ctx.lineWidth=3;
ctx.strokeRect(0,0,canvas.width,canvas.height);
}

function draw(){
ctx.fillStyle="#000";
ctx.fillRect(0,0,canvas.width,canvas.height);

drawBorder();

ctx.fillStyle="#00ff88";
ctx.fillRect(food.x*size,food.y*size,size,size);

snakes.forEach((s,i)=>{
ctx.fillStyle=i==0?"#ff3333":"#33ccff";
s.forEach(p=>ctx.fillRect(p.x*size,p.y*size,size,size));
});
}

function move(id,dx,dy){
let s=snakes[id];
let h={x:s[0].x+dx,y:s[0].y+dy};

if(mode==="walls"){
if(h.x<0||h.y<0||h.x>=cells||h.y>=cells){run=false;return;}
}else{
h.x=(h.x+cells)%cells;
h.y=(h.y+cells)%cells;
}

s.unshift(h);

if(h.x==food.x&&h.y==food.y) spawnFood();
else s.pop();
}

function step(){
if(!run) return;

move(0,dx1,dy1);

if(mode==="local"||mode==="online") move(1,dx2,dy2);

if(mode==="online" && socket && socket.readyState===1){
socket.send(JSON.stringify(snakes));
}

draw();
}

function loop(){
if(!run) return;
step();
setTimeout(loop,SPEED);
}

/* Controls */
function setDir1(x,y){dx1=x;dy1=y}
function setDir2(x,y){dx2=x;dy2=y}

/* Fullscreen */
function goFullscreen(){
document.documentElement.requestFullscreen?.();
}

/* WebSocket */
function connectWS(){
document.getElementById("status").innerText="Connecting...";
socket=new WebSocket("ws://localhost:8080");

socket.onopen=()=>document.getElementById("status").innerText="Online";

socket.onerror=()=>{
document.getElementById("status").innerText="Online unavailable ‚Äì playing local";
mode="local";
};

socket.onclose=()=>{
document.getElementById("status").innerText="Online unavailable ‚Äì playing local";
mode="local";
};

socket.onmessage=e=>{
snakes=JSON.parse(e.data);
};
}
</script>
</body>
</html>
