<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snake Ultimate Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:Segoe UI,Arial;
  overflow:hidden;
}

canvas{display:block}

/* Rain */
#rain{
  position:fixed;
  inset:0;
  z-index:-10;
}

/* Glass UI */
.glass{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.25);
  box-shadow:0 0 25px rgba(255,0,0,.3);
  border-radius:14px;
  padding:12px;
}

button,select,input{
  background:#140000;
  color:white;
  border:1px solid #ff0033;
  border-radius:8px;
  padding:8px 12px;
  margin:4px;
  font-size:16px;
}

.hidden{display:none}

#info,#menu,#lobby{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
}

.panel{
  width:90%;
  max-width:420px;
}

#uiTop{
  position:fixed;
  top:10px;
  left:10px;
  right:10px;
  display:flex;
  justify-content:space-between;
  z-index:5;
}

#hud{
  position:fixed;
  bottom:120px;
  left:10px;
  z-index:5;
}

#gameWrap{
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#controls{
  position:fixed;
  bottom:10px;
  left:0;
  right:0;
  display:flex;
  justify-content:center;
  gap:12px;
  z-index:5;
}

.ctrl{
  width:60px;
  height:60px;
  border-radius:50%;
  font-size:22px;
}
</style>
</head>
<body>

<canvas id="rain"></canvas>

<!-- Info -->
<div id="info">
  <div class="glass panel">
    <h2>üêç Snake Ultimate</h2>
    <p>
Touch buttons to move.<br><br>
Modes: Classic, No-Walls, Speed, Practice, Battle Royale, Teams<br><br>
Multiplayer up to 10 players.<br>
Offline = Local play.
    </p>
    <button onclick="openMenu()">Continue</button>
  </div>
</div>

<!-- Menu -->
<div id="menu" class="hidden">
  <div class="glass panel">
    <h2>Main Menu</h2>

    Mode:
    <select id="modeSel">
      <option>Classic</option>
      <option>No-walls</option>
      <option>Speed</option>
      <option>Practice</option>
      <option>Battle Royale</option>
      <option>Teams</option>
    </select><br>

    <button onclick="startLocal()">Local Game</button>
    <button onclick="openLobby()">Multiplayer</button>
    <button onclick="toggleFull()">Fullscreen</button>
  </div>
</div>

<!-- Lobby -->
<div id="lobby" class="hidden">
  <div class="glass panel">
    <h2>Multiplayer</h2>

    Name:<br>
    <input id="playerName" value="Player"><br>

    Room code:<br>
    <input id="roomCode"><br>

    <button onclick="createRoom()">Create</button>
    <button onclick="joinRoom()">Join</button>

    <p id="serverStatus">Server: Offline</p>

    <button onclick="backMenu()">Back</button>
  </div>
</div>

<!-- UI -->
<div id="uiTop" class="hidden">
  <div class="glass">
    Mode: <span id="modeName"></span>
    <button onclick="togglePause()">Pause</button>
  </div>
  <div class="glass">
    Server: <span id="serverText">Offline</span>
  </div>
</div>

<div id="gameWrap" class="hidden">
  <canvas id="game"></canvas>
</div>

<div id="hud" class="glass hidden">
  Score: <span id="score">0</span><br>
  Time: <span id="time">0</span>s
</div>

<!-- Touch Controls -->
<div id="controls" class="hidden">
  <button class="ctrl" onclick="setDir(0,-1)">‚¨ÜÔ∏è</button>
  <button class="ctrl" onclick="setDir(-1,0)">‚¨ÖÔ∏è</button>
  <button class="ctrl" onclick="setDir(1,0)">‚û°Ô∏è</button>
  <button class="ctrl" onclick="setDir(0,1)">‚¨áÔ∏è</button>
</div>

<script>
/* ---------- Rain ---------- */
const rain=document.getElementById("rain"),rctx=rain.getContext("2d");
function resizeRain(){rain.width=innerWidth;rain.height=innerHeight}
resizeRain();addEventListener("resize",resizeRain);

const drops=Array.from({length:300},()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,v:4+Math.random()*6,l:10+Math.random()*20}));

function rainLoop(){
  rctx.clearRect(0,0,rain.width,rain.height);
  rctx.strokeStyle="rgba(255,0,0,0.35)";
  drops.forEach(d=>{
    rctx.beginPath();
    rctx.moveTo(d.x,d.y);
    rctx.lineTo(d.x,d.y+d.l);
    rctx.stroke();
    d.y+=d.v;
    if(d.y>innerHeight){d.y=-20;d.x=Math.random()*innerWidth}
  });
  requestAnimationFrame(rainLoop);
}
rainLoop();

/* ---------- UI ---------- */
function openMenu(){
  info.style.display="none";
  menu.style.display="flex";
}
function openLobby(){
  menu.style.display="none";
  lobby.style.display="flex";
  connectServer();
}
function backMenu(){
  lobby.style.display="none";
  menu.style.display="flex";
}
function toggleFull(){
  if(!document.fullscreenElement)document.body.requestFullscreen();
  else document.exitFullscreen();
}

/* ---------- Game ---------- */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
let size=0,grid=20;
let snake,dir,food;
let score=0,time=0,paused=false;
let mode="Classic";

function resizeGame(){
  size=Math.min(innerWidth,innerHeight)*0.9;
  canvas.width=canvas.height=size;
}
resizeGame();
addEventListener("resize",resizeGame);

function setDir(x,y){dir={x,y}}

function startLocal(){
  mode=modeSel.value;
  startGame();
}

function startGame(){
  menu.style.display="none";
  lobby.style.display="none";
  gameWrap.style.display="flex";
  uiTop.classList.remove("hidden");
  hud.classList.remove("hidden");
  controls.classList.remove("hidden");

  document.getElementById("modeName").innerText=mode;

  snake=[{x:10,y:10}];
  dir={x:1,y:0};
  food=randomFood();
  score=0;
  time=0;
}

function randomFood(){
  return {x:Math.random()*29|0,y:Math.random()*29|0};
}

function togglePause(){paused=!paused}

function drawCell(x,y,c){
  ctx.shadowBlur=10;
  ctx.shadowColor=c;
  ctx.fillStyle=c;
  ctx.fillRect(x*grid,y*grid,grid-1,grid-1);
}

function update(){
  if(paused)return;

  const speed=mode==="Speed"?2:1;
  for(let s=0;s<speed;s++){
    const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
    snake.unshift(head);

    if(head.x===food.x && head.y===food.y){
      score++;
      food=randomFood();
    }else snake.pop();

    if(mode!=="No-walls"){
      if(head.x<0||head.y<0||head.x>=30||head.y>=30) startGame();
    }
  }
}

function draw(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,size,size);

  ctx.strokeStyle="red";
  ctx.strokeRect(0,0,size,size);

  snake.forEach(p=>drawCell(p.x,p.y,"#ff0033"));
  drawCell(food.x,food.y,"#00ff00");
}

setInterval(()=>{update();draw()},120);
setInterval(()=>{if(!paused){time++;scoreEl.innerText=score;timeEl.innerText=time}},1000);

const scoreEl=document.getElementById("score");
const timeEl=document.getElementById("time");

/* ---------- Multiplayer ---------- */
let socket=null;
function connectServer(){
  try{
    socket=new WebSocket("wss://2s2onesgithubio-production.up.railway.app");
    socket.onopen=()=>{serverStatus.innerText="Server: Online";serverText.innerText="Online";}
    socket.onerror=offline;
    socket.onclose=offline;
  }catch{offline()}
}
function offline(){
  serverStatus.innerText="Server: Offline (Local)";
  serverText.innerText="Offline";
}
function createRoom(){socket?.send(JSON.stringify({type:"create"}));startGame()}
function joinRoom(){socket?.send(JSON.stringify({type:"join",room:roomCode.value}));startGame()}
</script>

</body>
</html>
